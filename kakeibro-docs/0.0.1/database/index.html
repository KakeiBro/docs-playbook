<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Database :: KakeiBro</title>
    <link rel="prev" href="../domain/ubiquitous-language.html">
    <link rel="next" href="../prototypes/index.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="stylesheet" href="../../../_/css/shiki.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">KakeiBro</a>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/orgs/KakeiBro/repositories" target="_blank">
          <span class="icon">
            <svg aria-hidden="true" data-icon="github" role="img" viewBox="0 0 98 96" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z" fill="#fff"/>
            </svg>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="kakeibro-docs" data-version="0.0.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../index.html">KakeiBro Docs</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../index.html">Introduction</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../onboarding/index.html">Onboarding</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../onboarding/backend.html">.NET Solution</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ci-cd.html">CI/CD</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../domain/index.html">Domain</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../domain/authentication-module.html">Authentication Module</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../domain/users-module.html">Users Module</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../domain/finances-module.html">Finances Module</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../domain/intelligence-module.html">Intelligence Module</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../domain/ubiquitous-language.html">Ubiquitous Language</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="index.html">Database</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../prototypes/index.html">Prototypes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../prototypes/o-auth.html">Google OAuth 2.0</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../prototypes/mfa.html">Multi Factor Authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../prototypes/apache-graphs-react.html">Apache Graphs on React</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../prototypes/forms.html">Form Libraries for React</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../prototypes/formik.html">Formik</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../prototypes/react-hook-form.html">React Hook Form</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../backend/index.html">Backend</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../backend/git-hooks.html">Git Hooks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../backend/net-modulith/net-modulith.html">.NET Modulith</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../backend/net-modulith/oauth.html">OAuth</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../backend/net-modulith/folder-structure.html">Folder Structure</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../backend/ci-cd-pipelines.html">CI/CD Pipelines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../backend/logging.html">Logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../backend/security.html">Security</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../frontend/index.html">Frontend</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../frontend/screens/screens.html">Wireframing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../frontend/screens/authentication.html">Authentication Screens</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../frontend/husky.html">Husky Setup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../frontend/ui-folder-structure-patterns.html">UI Folder Structure Patterns</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../frontend/ci-cd-pipelines.html">CI/CD Pipelines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../frontend/vitest.html">Vitest</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">KakeiBro Docs</span>
    <span class="version">0.0.1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="../index.html">KakeiBro Docs</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">0.0.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">KakeiBro Docs</a></li>
    <li><a href="index.html">Database</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Database</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Based on the needs of an application we can choose to make use of different data models
for storing the data.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Document databases</p>
</li>
<li>
<p>Relational databases</p>
</li>
<li>
<p>Graph databases</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Reference: <a href="https://a.co/d/gbnpdgS">Designing Data-Intensive Applications: The Big Ideas Behind Reliable, Scalable, and Maintainable Systems</a></p>
</div>
<div class="paragraph">
<p>It&#8217;s hard to say which approach is better, unless we go into the details of the
type of application we are going to be building. For our specific purposes, being
that we are going to deal with <em>personal finances</em>. But not in a highly interconnected
way in which we have tons of many-to-many relationships and the need to perform tons
of joins into them for different cross-user querying. We will follow a <em>document database</em>
approach.</p>
</div>
<div class="paragraph">
<p>Specifically, we will leverage <code>Redis OM</code>. Which is a specific library
(that is built on top of StackExchange.Redis) that leverages Redis' native JSON
document data type to store data to then connect that to an application by becoming a
translation layer at the level of an <strong>Object Mapper</strong>.</p>
</div>
<div class="paragraph">
<p>The document&#8217;s structure will try to leverage <em>locality</em> as much as possible, having
all the <a href="../domain/ubiquitous-language.html#bookkeeper" class="xref page">bookkeeper&#8217;s</a> information
under the same document, allowing for us to have access to data related to him and his
finances without the need for <em>client-side joining</em>. And it&#8217;s also due to the <em>start-upy</em>
nature of the whole project, in which new ideas might start coming later, and/or we require
for a fast development experience without too many hurdles that <strong>schema-<em>ful</em></strong> databases
might impose. (But it&#8217;s worth noting that the integration with EF Core (in .NET specifically),
allows for this overhead to be greatly simplified, since the concept of automated migrations
auto-generated from the object&#8217;s we write at the application level is a god-send when
used correctly).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conventions"><a class="anchor" href="#conventions"></a>Conventions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>And since a clear line needs to be drawn, these are the conventions we will use
for the different aspects of our database:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Database names &#8658; <code>snake_case</code> (Documents, fields, constraints) (always in plural)</p>
</li>
<li>
<p>Primary IDs &#8658; <code>id</code> or <code>document_id</code></p>
</li>
<li>
<p>Document references &#8658; <code>document_id</code></p>
</li>
<li>
<p>Indexes/constraints &#8658; <code>idx_</code>, <code>fk_</code>, <code>chk_</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And due to the Document based nature of how we will store our data in Redis, the diagram
we chose to represent it will be of a <em>Class Diagram</em>, however with a <a href="#documents-diagram"><em>tree-like structure</em>.</a>
It&#8217;s <strong>imperative</strong> to leave clear that we will store inside of a parent object
in which all the other children will hold themselves other levels of data.</p>
</div>
<div class="paragraph">
<p>And it&#8217;s also important to state clearly that Redis is a <strong>key-value</strong> store. It&#8217;s not
relational in nature, and it doesn&#8217;t enforce schemas like SQL databases. It&#8217;s through
the usage of its own convention in the form of <em>key paths</em> that we will be able to store our documents
with a clear logical order in mind. It will be through this usage that we will also
adhere to the <a href="../backend/net-modulith/net-modulith.html" class="xref page">modular monolith</a> architecture pattern,
specifically on the concern of isolating data between modules.</p>
</div>
<div class="paragraph">
<p>Another important convention we will always aim at adhering to is <strong>to never physically
delete records</strong>. (Unless a compelling argument arises for doing so). We should always
have a <code>deleted</code> field with a <code>true</code> representing the record is logically deleted (or not).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="key-paths"><a class="anchor" href="#key-paths"></a>Key Paths</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We will hold a structure such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>auth</p>
<div class="ulist">
<ul>
<li>
<p>user (E.g., <code>auth:user:1</code>)</p>
</li>
</ul>
</div>
</li>
<li>
<p>finances (E.g., <code>finances:*</code>)</p>
<div class="ulist">
<ul>
<li>
<p>TBD</p>
</li>
</ul>
</div>
</li>
<li>
<p>intelligence (E.g., <code>intelligence:*</code>)</p>
<div class="ulist">
<ul>
<li>
<p>TBD</p>
</li>
</ul>
</div>
</li>
<li>
<p>users (E.g., <code>users:*</code>)</p>
<div class="ulist">
<ul>
<li>
<p>TBD</p>
</li>
</ul>
</div>
</li>
<li>
<p>projection (E.g., <code>projection:*</code>)</p>
<div class="ulist">
<ul>
<li>
<p>TBD</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>And it&#8217;s each entry that will correspond to a numeral ID that we will
have our documents saved to. As you can see the <strong>parent key path</strong> will be of the
<strong>respective module</strong>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="documents-diagram"><a class="anchor" href="#documents-diagram"></a>Documents diagram</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We will document each module&#8217;s data document structure in isolation (following the idea
of the <em>Modular Monolith</em> approach), but also for simplicity and readability&#8217;s sake.</p>
</div>
<div class="sect2">
<h3 id="authentication-module"><a class="anchor" href="#authentication-module"></a>Authentication Module</h3>
<div class="imageblock">
<div class="content">
<img src="_images/auth-diagram.jpg" alt="auth diagram">
</div>
</div>
<div class="paragraph text-center">
<p><em>Figure 1. Authentication module&#8217;s data model</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>users</code> is the heart of this module (<em>aggregate root in DDD</em>), it will save data that Google&#8217;s
API will provide on the initial <a href="../domain/ubiquitous-language.html#auth-handshake" class="xref page">handshake</a>
plus storing in a nested document array the different tokens that might be created across the usage
of the system. <strong><em>BIG NOTE:</em></strong> Each new record on the <code>tokens</code> collection should have
its <code>value</code> field blanked out the moment it&#8217;s marked as <code>deleted</code> for security purposes
(plus having that same token revoked on the Google side).<br>
Also attached to the user we will have a list of different MFA devices in case the
user configures one.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Extra Note:</strong> One of the most important pieces of information on this module will be
the <code>email</code> from a user, plus a <code>value</code> from a token attached to the user. It&#8217;s due
to this very fact that those two values must be <a href="../backend/security.html" class="xref page">encrypted</a>
and only decrypted at run-time for specific usage of their underlying values.</p>
</div>
<div class="paragraph">
<p>One key part of this whole module&#8217;s data model is the fact that we are using <code>int</code>
as the ID for each document. This is <em>on purpose</em> to have an easier time tying that
back to the <em>Redis keypaths</em>, being that if we were to use GUIDs of any nature, the
readability and ease of search for records would be vastly more challenging. (For other
use cases, a GUID would be more suited, specially if we know that an <code>int</code> would reach
its maximum value over time on the system).</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="../domain/ubiquitous-language.html">Ubiquitous Language</a></span>
  <span class="next"><a href="../prototypes/index.html">Prototypes</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
