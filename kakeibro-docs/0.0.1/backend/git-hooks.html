<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Git Hooks :: KakeiBro</title>
    <link rel="prev" href="index.html">
    <link rel="next" href="net-modulith/net-modulith.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="stylesheet" href="../../../_/css/shiki.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">KakeiBro</a>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/orgs/KakeiBro/repositories" target="_blank">
          <span class="icon">
            <svg aria-hidden="true" data-icon="github" role="img" viewBox="0 0 98 96" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z" fill="#fff"/>
            </svg>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="kakeibro-docs" data-version="0.0.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../index.html">KakeiBro Docs</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../index.html">Introduction</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../onboarding/index.html">Onboarding</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../onboarding/backend.html">.NET Solution</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ci-cd.html">CI/CD</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../domain/index.html">Domain</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../domain/authentication-module.html">Authentication Module</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../domain/users-module.html">Users Module</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../domain/finances-module.html">Finances Module</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../domain/intelligence-module.html">Intelligence Module</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../domain/ubiquitous-language.html">Ubiquitous Language</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../database/index.html">Database</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../prototypes/index.html">Prototypes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../prototypes/o-auth.html">Google OAuth 2.0</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../prototypes/mfa.html">Multi Factor Authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../prototypes/apache-graphs-react.html">Apache Graphs on React</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../prototypes/forms.html">Form Libraries for React</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../prototypes/formik.html">Formik</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../prototypes/react-hook-form.html">React Hook Form</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Backend</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="git-hooks.html">Git Hooks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="net-modulith/net-modulith.html">.NET Modulith</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="net-modulith/oauth.html">OAuth</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="net-modulith/folder-structure.html">Folder Structure</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="net-modulith/authentication-module.html">Authentication Module</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ci-cd-pipelines.html">CI/CD Pipelines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="logging.html">Logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="security.html">Security</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../frontend/index.html">Frontend</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../frontend/screens/screens.html">Wireframing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../frontend/screens/authentication.html">Authentication Screens</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../frontend/husky.html">Husky Setup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../frontend/modules.html">Modules</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../frontend/modules/auth-module.html">Authentication Module</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../frontend/ui-folder-structure-patterns.html">UI Folder Structure Patterns</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../frontend/ci-cd-pipelines.html">CI/CD Pipelines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../frontend/vitest.html">Vitest</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../frontend/react-router.html">React Router</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">KakeiBro Docs</span>
    <span class="version">0.0.1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="../index.html">KakeiBro Docs</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">0.0.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">KakeiBro Docs</a></li>
    <li><a href="index.html">Backend</a></li>
    <li><a href="git-hooks.html">Git Hooks</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Git Hooks</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Whilst <a href="../frontend/husky.html" class="xref page">in the Frontend</a> we are leveraging <strong>Husky</strong>, we are
not really leveraging <code>node</code> in the backend, this is entirely a .NET Solution. And so,
we won&#8217;t leverage that specific tool. In its place we will leverage <strong>Git Hooks</strong>,
<em>Husky</em> is a wrapper around git hooks by the end of the day.</p>
</div>
<div class="paragraph">
<p>Whilst <code>husky</code> helps bridging the gap between UNIX and Windows workstations, we have to
setup a bit further when using raw <em>Git Hooks</em> since depending on the OS the commands
that run will not work on a case-by-case basis.</p>
</div>
<div class="paragraph">
<p>This is the order of steps used to setup a new hook:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a hook file at <code>kakeibro-api/git-hooks/</code></p>
</li>
<li>
<p>You can test if the hooks are working as intended by running <code>git commit --amend --no-edit</code>
followed then by <code>git push --force</code> (you could also just roll-back if you don&#8217;t want
to push anything).</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Make sure you have run the <a href="../onboarding/index.html" class="xref page">Onboarding</a> first, otherwise
none of the things stated further will work as intended.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Git hooks can insert themselves in different stages of the commit lifecycle, we are
<em>at least for the time being</em> leveraging <code>pre-commit</code> and <code>pre-push</code>, which before letting us actually
save the commit to VC it will police our changes.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="hooks" class="paragraph">
<p>The <strong>pre-commit</strong> hook we have at the <code>git-hooks</code> folder of the repository is <strong>cross-platform</strong>,
it will run both on <strong><em>Windows and Linux</em></strong>, depending on the OS it will then execute either
<code>pre-commit.sh</code> or <code>pre-commit.ps1</code>.</p>
</div>
<div class="paragraph">
<p>The <strong>post-commit</strong> hook we have at the <code>git-hooks</code> folder is also cross-platform
and will execute the respective script based on the OS.</p>
</div>
<div class="paragraph">
<p>The <strong>pre-push</strong> hook we have at the <code>git-hooks</code> folder is also cross-platform and will
execute the respective script based on the OS.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It&#8217;s worth noting that the moment a hook runs, its executing path will be the root path at
which we have the <code>.git</code> folder. Meaning that based on that starting point all the logic
we set in place should be built accordingly.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="windows-setup"><a class="anchor" href="#windows-setup"></a>Windows Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All logic specific to Windows, will make use of <strong>powershell</strong>, so any commands specific
to that CLI are present in here.</p>
</div>
<div class="paragraph">
<p>The <code>pre-commit.ps1</code> script takes care of doing the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Checking code format (according to conventions)</p>
</li>
<li>
<p>Building the solution</p>
</li>
<li>
<p>Running all tests</p>
</li>
<li>
<p>Running <code>appsettings.json</code> OAuth credential sanitization by blanking out sensitive fields,
and backing up the contents for the <code>post-commit</code> hook to then finish this specific
flow</p>
<div class="ulist">
<ul>
<li>
<p><em>NOTE</em>: Some links in regards to windows specific issues with jq and passing things with
double quotes:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://stackoverflow.com/questions/67636275/why-jq-does-not-compile-when-i-pass-a-powershell-variable">jq doesn&#8217;t compile</a></p>
</li>
<li>
<p><a href="https://github.com/jqlang/jq/issues/2640">double quote fix</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>post-commit.ps1</code> script takes care of doing the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Work in conjunction with the <code>pre-commit.ps1</code> file so that once its backup <code>appsettings.json</code>
contents are saved in a different file, this then restores all of that into the
original <code>appsettings.json</code> file and deletes the backup file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>pre-push.ps1</code> script takes care of doing the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Checking code format (according to conventions)</p>
</li>
<li>
<p>Building the solution</p>
</li>
<li>
<p>Running all tests</p>
</li>
<li>
<p>Running a check for possibly outdated packages</p>
<div class="ulist">
<ul>
<li>
<p><em>NOTE:</em> This will never fail, the command only lists out its findings, a good
still to let people know as they work that something might need an update.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Running migrations (<strong>TBD</strong>: <em>This requires for Entity Framework to be installed and
setup up in a specific project(s)</em>)</p>
</li>
<li>
<p>Running a check on possible vulnerable packages</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The difference between the amount of operations each stage has has been configured with intent.
Whilst simply comitting we shouldn&#8217;t have to disrupt the developer experience as much since changes might
get overwritten later, and the <em>flow state</em> might end up taking a hit. However, before trying to push
something to version control we will run as many checks as we can so that we are not pushing bad code
that could end up breaking the build.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="linux-setup"><a class="anchor" href="#linux-setup"></a>Linux Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All logic specific to Linux, will make use of <strong>bash</strong>, so any commands specific
to that CLI are present in here.</p>
</div>
<div class="paragraph">
<p>The <code>pre-commit.sh</code> script takes care of doing the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Checking code format (according to conventions)</p>
</li>
<li>
<p>Building the solution</p>
</li>
<li>
<p>Running all tests</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>pre-push.sh</code> script takes care of doing the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Checking code format (according to conventions)</p>
</li>
<li>
<p>Building the solution</p>
</li>
<li>
<p>Running all tests</p>
</li>
<li>
<p>Running a check for possibly outdated packages</p>
<div class="ulist">
<ul>
<li>
<p><em>NOTE:</em> This will never fail, the command only lists out its findings, a good
still to let people know as they work that something might need an update.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Running migrations (<strong>TBD</strong>: <em>This requires for Entity Framework to be installed and
setup up in a specific project(s)</em>)</p>
</li>
<li>
<p>Running a check on possible vulnerable packages</p>
</li>
</ul>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html">Backend</a></span>
  <span class="next"><a href="net-modulith/net-modulith.html">.NET Modulith</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
