<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>.NET Modulith :: KakeiBro</title>
    <link rel="prev" href="../git-hooks.html">
    <link rel="next" href="oauth.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <link rel="stylesheet" href="../../../../_/css/shiki.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../..">KakeiBro</a>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/orgs/KakeiBro/repositories" target="_blank">
          <span class="icon">
            <svg aria-hidden="true" data-icon="github" role="img" viewBox="0 0 98 96" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z" fill="#fff"/>
            </svg>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="kakeibro-docs" data-version="0.0.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../../index.html">KakeiBro Docs</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../index.html">Introduction</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../onboarding/index.html">Onboarding</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../onboarding/backend.html">.NET Solution</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../ci-cd.html">CI/CD</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../domain/index.html">Domain</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../domain/authentication-module.html">Authentication Module</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../domain/users-module.html">Users Module</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../domain/finances-module.html">Finances Module</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../domain/intelligence-module.html">Intelligence Module</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../domain/ubiquitous-language.html">Ubiquitous Language</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../database/index.html">Database</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../prototypes/index.html">Prototypes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../prototypes/o-auth.html">Google OAuth 2.0</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../prototypes/mfa.html">Multi Factor Authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../prototypes/apache-graphs-react.html">Apache Graphs on React</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../prototypes/forms.html">Form Libraries for React</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../prototypes/formik.html">Formik</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../prototypes/react-hook-form.html">React Hook Form</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../index.html">Backend</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../git-hooks.html">Git Hooks</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="net-modulith.html">.NET Modulith</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="oauth.html">OAuth</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="folder-structure.html">Folder Structure</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ci-cd-pipelines.html">CI/CD Pipelines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../logging.html">Logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security.html">Security</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../frontend/index.html">Frontend</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../frontend/screens/screens.html">Wireframing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../frontend/screens/authentication.html">Authentication Screens</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../frontend/husky.html">Husky Setup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../frontend/ui-folder-structure-patterns.html">UI Folder Structure Patterns</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../frontend/ci-cd-pipelines.html">CI/CD Pipelines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../frontend/vitest.html">Vitest</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">KakeiBro Docs</span>
    <span class="version">0.0.1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="../../index.html">KakeiBro Docs</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">0.0.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">KakeiBro Docs</a></li>
    <li><a href="../index.html">Backend</a></li>
    <li><a href="net-modulith.html">.NET Modulith</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">.NET Modulith</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The backend&#8217;s main node is the ASP.NET Core Restful Web API, that is built based on the
Modular Monolith Architecture Pattern.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="centralized-build-props"><a class="anchor" href="#centralized-build-props"></a>Centralized Build Props</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Whilst there&#8217;s certainly patterns that involve having a <em>shared</em> project that holds
references to both NuGets and General Use classes for a whole solution. We can also
leverage another type of pattern. And this involves making use of a <code>Directory.build.props</code>
file. Files such as this one can abstract away centralized configurations both for build
processes (separating concerns such as static analyzer warnings and errors), and
other cross cutting concerns such as NuGet package versioning.</p>
</div>
<div class="listingblock">
<div class="content">
<html><head></head><body><pre class="shiki highlight monokai" style="--shiki-background-color: #272822; --shiki-conum-bg-color: #d2d2cd; --shiki-conum-fg-color: #000000;"><code data-lang="xml" class="shiki has-line-numbers override-conums" style="--shiki-line-number-start: 1; --shiki-line-number-color: #757866;"><span class="line"><span style="color: #F8F8F2">&lt;</span><span style="color: #F92672">Project</span><span style="color: #F8F8F2">&gt;</span></span>
<span class="line"><span style="color: #F8F8F2">    &lt;</span><span style="color: #F92672">PropertyGroup</span><span style="color: #F8F8F2">&gt;</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #88846F">&lt;!--Default Project Setttings--&gt;</span><span style="color: #F8F8F2"> </span><i class="conum" data-value="1"></i><b>(1)</b></span>
<span class="line"><span style="color: #F8F8F2">        &lt;</span><span style="color: #F92672">TargetFramework</span><span style="color: #F8F8F2">&gt;net9.0&lt;/</span><span style="color: #F92672">TargetFramework</span><span style="color: #F8F8F2">&gt;</span></span>
<span class="line"><span style="color: #F8F8F2">        &lt;</span><span style="color: #F92672">Nullable</span><span style="color: #F8F8F2">&gt;enable&lt;/</span><span style="color: #F92672">Nullable</span><span style="color: #F8F8F2">&gt;</span></span>
<span class="line"><span style="color: #F8F8F2">        &lt;</span><span style="color: #F92672">ImplicitUsings</span><span style="color: #F8F8F2">&gt;enable&lt;/</span><span style="color: #F92672">ImplicitUsings</span><span style="color: #F8F8F2">&gt;</span></span>
<span class="line"><span style="color: #F8F8F2">        &lt;</span><span style="color: #F92672">DockerDefaultTargetOS</span><span style="color: #F8F8F2">&gt;Linux&lt;/</span><span style="color: #F92672">DockerDefaultTargetOS</span><span style="color: #F8F8F2">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #88846F">&lt;!--Static Analyzers Settings--&gt;</span></span>
<span class="line"><span style="color: #F8F8F2">        &lt;</span><span style="color: #F92672">AnalysisLevel</span><span style="color: #F8F8F2">&gt;latest&lt;/</span><span style="color: #F92672">AnalysisLevel</span><span style="color: #F8F8F2">&gt; </span><i class="conum" data-value="2"></i><b>(2)</b></span>
<span class="line"><span style="color: #F8F8F2">        &lt;</span><span style="color: #F92672">AnalysisMode</span><span style="color: #F8F8F2">&gt;All&lt;/</span><span style="color: #F92672">AnalysisMode</span><span style="color: #F8F8F2">&gt;</span></span>
<span class="line"><span style="color: #F8F8F2">        &lt;</span><span style="color: #F92672">TreatWarningsAsErrors</span><span style="color: #F8F8F2">&gt;true&lt;/</span><span style="color: #F92672">TreatWarningsAsErrors</span><span style="color: #F8F8F2">&gt;</span></span>
<span class="line"><span style="color: #F8F8F2">        &lt;</span><span style="color: #F92672">CodeAnalysisTreatWarningsAsErrors</span><span style="color: #F8F8F2">&gt;true&lt;/</span><span style="color: #F92672">CodeAnalysisTreatWarningsAsErrors</span><span style="color: #F8F8F2">&gt;</span></span>
<span class="line"><span style="color: #F8F8F2">        &lt;</span><span style="color: #F92672">EnforceCodeStyleInBuild</span><span style="color: #F8F8F2">&gt;true&lt;/</span><span style="color: #F92672">EnforceCodeStyleInBuild</span><span style="color: #F8F8F2">&gt;</span></span>
<span class="line"><span style="color: #F8F8F2">    &lt;/</span><span style="color: #F92672">PropertyGroup</span><span style="color: #F8F8F2">&gt;</span></span>
<span class="line"><span style="color: #F8F8F2">&lt;/</span><span style="color: #F92672">Project</span><span style="color: #F8F8F2">&gt;</span></span></code></pre></body></html>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>When building a project, all these properties wil be applied to all projects of
the solution.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>And also, when running a build on a project, we will have all these settings for
static analyzers warnings to be painted as errors.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="centralized-nuget-packages"><a class="anchor" href="#centralized-nuget-packages"></a>Centralized NuGet packages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Following the same idea at <a href="#centralized-build-props">Centralized Build Props</a> we can also use a file
called <code>Directory.Packages.props</code>. It is at this file that we can then declare
all sorts of NuGet packages that we want to be centralized, this
brings us the benefit of having one version for all projects in one file, instead of
having to go into each project and managing versions on their own. Now this should be
definitely used with foresight, since there are use cases the definitely will not benefit
from this at all.</p>
</div>
<div class="listingblock">
<div class="content">
<html><head></head><body><pre class="shiki highlight monokai" style="--shiki-background-color: #272822; --shiki-conum-bg-color: #d2d2cd; --shiki-conum-fg-color: #000000;"><code data-lang="xml" class="shiki has-line-numbers override-conums" style="--shiki-line-number-start: 1; --shiki-line-number-color: #757866;"><span class="line"><span style="color: #F8F8F2">&lt;</span><span style="color: #F92672">Project</span><span style="color: #F8F8F2">&gt;</span></span>
<span class="line"><span style="color: #F8F8F2">    &lt;</span><span style="color: #F92672">PropertyGroup</span><span style="color: #F8F8F2">&gt;</span></span>
<span class="line"><span style="color: #F8F8F2">        &lt;</span><span style="color: #F92672">ManagePackageVersionsCentrally</span><span style="color: #F8F8F2">&gt;true&lt;/</span><span style="color: #F92672">ManagePackageVersionsCentrally</span><span style="color: #F8F8F2">&gt; </span><i class="conum" data-value="1"></i><b>(1)</b></span>
<span class="line"><span style="color: #F8F8F2">    &lt;/</span><span style="color: #F92672">PropertyGroup</span><span style="color: #F8F8F2">&gt;</span></span>
<span class="line"><span style="color: #F8F8F2">    &lt;</span><span style="color: #F92672">ItemGroup</span><span style="color: #F8F8F2">&gt;</span></span>
<span class="line"><span style="color: #F8F8F2">        &lt;</span><span style="color: #F92672">PackageVersion</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">Include</span><span style="color: #F8F8F2">=</span><span style="color: #E6DB74">"SonarAnalyzer.CSharp"</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">Version</span><span style="color: #F8F8F2">=</span><span style="color: #E6DB74">"10.6.0.109712"</span><span style="color: #F8F8F2">/&gt; </span><i class="conum" data-value="2"></i><b>(2)</b></span>
<span class="line"><span style="color: #F8F8F2">        &lt;</span><span style="color: #F92672">PackageVersion</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">Include</span><span style="color: #F8F8F2">=</span><span style="color: #E6DB74">"StyleCop.Analyzers"</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">Version</span><span style="color: #F8F8F2">=</span><span style="color: #E6DB74">"1.2.0-beta.556"</span><span style="color: #F8F8F2">/&gt;</span></span>
<span class="line"><span style="color: #F8F8F2">    &lt;/</span><span style="color: #F92672">ItemGroup</span><span style="color: #F8F8F2">&gt;</span></span>
<span class="line"><span style="color: #F8F8F2">&lt;/</span><span style="color: #F92672">Project</span><span style="color: #F8F8F2">&gt;</span></span></code></pre></body></html>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We have to set this setting so that all projects of the solution will refer to the
package versions declared in this <code>props</code> file.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>And the way to add the packages that will be exposed to projects is pretty straightforward,
we will simply reference them as we would in a normal <code>.csproj</code> file</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And now, if we want to reference the packages and have them available, we can simply
declare them in any project file as such:</p>
</div>
<div class="listingblock">
<div class="content">
<html><head></head><body><pre class="shiki highlight monokai" style="--shiki-background-color: #272822; --shiki-conum-bg-color: #d2d2cd; --shiki-conum-fg-color: #000000;"><code data-lang="xml" class="shiki has-line-numbers override-conums" style="--shiki-line-number-start: 1; --shiki-line-number-color: #757866;"><span class="line"><span style="color: #F8F8F2">&lt;</span><span style="color: #F92672">Project</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">Sdk</span><span style="color: #F8F8F2">=</span><span style="color: #E6DB74">"Microsoft.NET.Sdk.Web"</span><span style="color: #F8F8F2">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    &lt;</span><span style="color: #F92672">ItemGroup</span><span style="color: #F8F8F2">&gt;</span></span>
<span class="line"><span style="color: #F8F8F2">        &lt;</span><span style="color: #F92672">PackageReference</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">Include</span><span style="color: #F8F8F2">=</span><span style="color: #E6DB74">"SonarAnalyzer.CSharp"</span><span style="color: #F8F8F2">/&gt; </span><i class="conum" data-value="1"></i><b>(1)</b></span>
<span class="line"><span style="color: #F8F8F2">        &lt;</span><span style="color: #F92672">PackageReference</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">Include</span><span style="color: #F8F8F2">=</span><span style="color: #E6DB74">"StyleCop.Analyzers"</span><span style="color: #F8F8F2">/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">        &lt;</span><span style="color: #F92672">PackageReference</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">Include</span><span style="color: #F8F8F2">=</span><span style="color: #E6DB74">"Microsoft.AspNetCore.OpenApi"</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">VersionOverride</span><span style="color: #F8F8F2">=</span><span style="color: #E6DB74">"9.0.0"</span><span style="color: #F8F8F2">/&gt; </span><i class="conum" data-value="2"></i><b>(2)</b></span>
<span class="line"><span style="color: #F8F8F2">    &lt;/</span><span style="color: #F92672">ItemGroup</span><span style="color: #F8F8F2">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    &lt;</span><span style="color: #F92672">ItemGroup</span><span style="color: #F8F8F2">&gt;</span></span>
<span class="line"><span style="color: #F8F8F2">      &lt;</span><span style="color: #F92672">Content</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">Include</span><span style="color: #F8F8F2">=</span><span style="color: #E6DB74">"..\..\.dockerignore"</span><span style="color: #F8F8F2">&gt;</span></span>
<span class="line"><span style="color: #F8F8F2">        &lt;</span><span style="color: #F92672">Link</span><span style="color: #F8F8F2">&gt;.dockerignore&lt;/</span><span style="color: #F92672">Link</span><span style="color: #F8F8F2">&gt;</span></span>
<span class="line"><span style="color: #F8F8F2">      &lt;/</span><span style="color: #F92672">Content</span><span style="color: #F8F8F2">&gt;</span></span>
<span class="line"><span style="color: #F8F8F2">    &lt;/</span><span style="color: #F92672">ItemGroup</span><span style="color: #F8F8F2">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">&lt;/</span><span style="color: #F92672">Project</span><span style="color: #F8F8F2">&gt;</span></span>
<span class="line"></span></code></pre></body></html>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We have to simply reference centralized packages under a <code>PackageReference</code> tag, without versions.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If we want to install specific packages for the project, we can still do it by
putting explicitly the name and version of it. And this way we connect projects with a
centralized package versioning file and we get rid of the hassle of having to go through
each project to update things whilst maintaining specific packages for specific projects.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It&#8217;s worth noting that by the NuGet team&#8217;s recommendation it&#8217;s recommended to have
everything under the <code>Directory.Packages.props</code> file, but this defeats a bit of
the purpose of centralizing without coupling dependencies. I might get back on this,
but when it comes to <em>importing things unnecesarily</em> we should be safe. By actually
referencing a package in the <code>.csproj</code> file it will then attempt to get a reference
to the NuGet and we will have that dependency in our final bundle.</p>
</div>
<div class="paragraph">
<p><strong>All projects will not have the NuGet package taking up space</strong>. It&#8217;s by declaring the
reference (without the version) that the connection for the package procurement will
then take place.</p>
</div>
<div class="paragraph">
<p>It&#8217;s on my own when testing the <a href="../ci-cd-pipelines.html#docker-image" class="xref page">docker build</a> process
that I found two issues, <a href="https://learn.microsoft.com/en-us/nuget/reference/errors-and-warnings/nu1008">NU1008</a> and
even <a href="https://learn.microsoft.com/en-us/nuget/reference/errors-and-warnings/nu1604">NU1604</a>.
Even though the IDEs might be smart enough to pick up on the <code>Directory.*</code> files and then
reconcile that info with each project&#8217;s declaration of a specific package declaration,
the tool itself forces us to <strong>not have floating packages</strong>. Unless we are really explicit,
and thanks to the <a href="https://learn.microsoft.com/en-us/nuget/consume-packages/central-package-management#overriding-package-versions">docs</a>
it is that I found that we can declare an <strong>override</strong> so that a specific project can declare
its own package version there and <em>IMHO</em> abstract clutter from specific project use
cases to them and not having it in our <em>centralized</em> package declaration file.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="global-usings"><a class="anchor" href="#global-usings"></a>Global Usings</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A feature that came all the way from <strong>.NET 8</strong>, is the usage of <code>GlobalUsings</code>, these
were already present from some time now in the form of <em>auto-generated</em> files. However,
it&#8217;s on this <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/proposals/csharp-10.0/globalusingdirective">.NET version</a>
that it was introduced a pattern to keep files cleaner by abstracting commonly imported dependencies
through a <em>GlobalUsings.cs</em> file.</p>
</div>
<div class="paragraph">
<p>So any type of import that we will be using across an application is a great candidate
to add as a <code>global using &lt;namespace&gt;</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There&#8217;s an issue (at least at the time of writing) with <code>StyleCop.Analyzers</code>, and that&#8217;s
rule <strong><em>SA1200</em></strong> on these global usings files. <a href="https://github.com/DotNetAnalyzers/StyleCopAnalyzers/issues/3404">Info</a>.
Due to this still not working as intended, we will <em>Turn off the rule for <strong>this file
ONLY</strong></em></p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="libraries"><a class="anchor" href="#libraries"></a>Libraries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since we will require some level of dependencies in order to connect to the Web API,
plus our own technical concerns we will make sure to install only the neccesary
Nuget packages as to keep our module lean and lightweight. This would be things
such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Microsoft.Extensions.Configuration</p>
</li>
<li>
<p>Microsoft.Extensions.DependencyInjection</p>
</li>
<li>
<p>Microsoft.AspNetCore.Routing</p>
</li>
<li>
<p>Microsoft.AspNetCore.Http.Abstractions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>HOWEVER:</strong> By enabling the ASP.NET Core abstractions in the project through the addition
of a specific section in its <code>.csproj</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<html><head></head><body><pre class="shiki highlight monokai" style="--shiki-background-color: #272822; --shiki-conum-bg-color: #d2d2cd; --shiki-conum-fg-color: #000000;"><code class="shiki has-line-numbers override-conums" style="--shiki-line-number-start: 1; --shiki-line-number-color: #757866;"><span class="line"><span style="color: #F8F8F2">&lt;ItemGroup&gt;</span></span>
<span class="line"><span style="color: #F8F8F2">    &lt;FrameworkReference Include="Microsoft.AspNetCore.App" /&gt;</span></span>
<span class="line"><span style="color: #F8F8F2">&lt;/ItemGroup&gt;</span></span></code></pre></body></html>
</div>
</div>
<div class="paragraph">
<p>Our class libraries will have access to all the types, APIs, and dependencies provided
by the ASP.NET Core framework. Without the need of installing libraries individually.</p>
</div>
<div class="paragraph">
<p>Instead of copying referenced assemblies into the project&#8217;s output directory,
it relies on the shared framework that is installed on the <em>target machine</em> or
included in the <em>runtime</em>. Reducing the size of the output. (<em>It also helps with
consistent versioning</em>).</p>
</div>
<div class="paragraph">
<p><strong>BIG NOTE:</strong> We are taking this decision since our class libraries are specifically
designted to work with <code>ASP.NET Core</code>. And since we are abstracting away endpoint
registration, we need access to the framework&#8217;s specific types and features. But most
importantly, <em>we want to avoid bloating our projects with redundant copies of assemblies</em>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="module-architecture"><a class="anchor" href="#module-architecture"></a>Module Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All modules should follow a specific structure, by adhering to this structure we
are making sure that we keep our code organized, predictable and more maintainable in
the long run. Whilst our approach might delve a bit into <em>too much abstraction</em>.
We have to emphasize the idea that the initial setup (and learning curve) might be
the biggest hurdle, but once you are comfortable with the project, then things should
fall into place without much issue.</p>
</div>
<div class="paragraph">
<p>Just know that everything starts from the Web API&#8217;s <code>Program.cs</code> side. We make two
important calls there:</p>
</div>
<div class="listingblock">
<div class="content">
<html><head></head><body><pre class="shiki highlight monokai" style="--shiki-background-color: #272822; --shiki-conum-bg-color: #d2d2cd; --shiki-conum-fg-color: #000000;"><code data-lang="csharp" class="shiki has-line-numbers override-conums" style="--shiki-line-number-start: 1; --shiki-line-number-color: #757866;"><span class="line"><span style="color: #F8F8F2">builder.Services.</span><span style="color: #A6E22E">InstallModulesFromAssemblies</span><span style="color: #F8F8F2">( </span><i class="conum" data-value="1"></i><b>(1)</b></span>
<span class="line"><span style="color: #F8F8F2">    builder.Configuration,</span></span>
<span class="line"><span style="color: #F8F8F2">    Modules.Authentication.AssemblyReference.Assembly);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">app.</span><span style="color: #A6E22E">InstallEndpointsFromAssemblies</span><span style="color: #F8F8F2">( </span><i class="conum" data-value="2"></i><b>(2)</b></span>
<span class="line"><span style="color: #F8F8F2">    app.Configuration,</span></span>
<span class="line"><span style="color: #F8F8F2">    Modules.Authentication.AssemblyReference.Assembly);</span></span></code></pre></body></html>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We have different services, and things specific to a module that we have to
<em>"install"</em> on our app. And it&#8217;s through this extension method that we can feed all
the configurations to be loaded into the app, plus sending assembly references that will
help us scan the whole project to then start registering the different components.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>And just like the <code>services</code> use case, we also have to scan for different endpoints
(since we will be using Minimal APIs), and this takes place after the app container has
been built and we now deal with the HTTP pipeline.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With that in mind, each module should always have its own <code>IModuleInstaller</code>. If we
don&#8217;t have this, then none of the methods we laid out before will pick up on the respective
interface to then kickstart further registrations.</p>
</div>
<div class="listingblock">
<div class="content">
<html><head></head><body><pre class="shiki highlight monokai" style="--shiki-background-color: #272822; --shiki-conum-bg-color: #d2d2cd; --shiki-conum-fg-color: #000000;"><code data-lang="csharp" class="shiki has-line-numbers override-conums" style="--shiki-line-number-start: 1; --shiki-line-number-color: #757866;"><span class="line"><span style="color: #F92672">using</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E; text-decoration: underline">Common</span><span style="color: #F8F8F2">.</span><span style="color: #A6E22E; text-decoration: underline">Library</span><span style="color: #F8F8F2">;</span></span>
<span class="line"><span style="color: #F92672">using</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E; text-decoration: underline">Common</span><span style="color: #F8F8F2">.</span><span style="color: #A6E22E; text-decoration: underline">Library</span><span style="color: #F8F8F2">.</span><span style="color: #A6E22E; text-decoration: underline">Interfaces</span><span style="color: #F8F8F2">;</span></span>
<span class="line"><span style="color: #F92672">using</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E; text-decoration: underline">Microsoft</span><span style="color: #F8F8F2">.</span><span style="color: #A6E22E; text-decoration: underline">Extensions</span><span style="color: #F8F8F2">.</span><span style="color: #A6E22E; text-decoration: underline">Configuration</span><span style="color: #F8F8F2">;</span></span>
<span class="line"><span style="color: #F92672">using</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E; text-decoration: underline">Microsoft</span><span style="color: #F8F8F2">.</span><span style="color: #A6E22E; text-decoration: underline">Extensions</span><span style="color: #F8F8F2">.</span><span style="color: #A6E22E; text-decoration: underline">DependencyInjection</span><span style="color: #F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #66D9EF; font-style: italic">namespace</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E; text-decoration: underline">Modules</span><span style="color: #F8F8F2">.</span><span style="color: #A6E22E; text-decoration: underline">Authentication</span><span style="color: #F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672">public</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF; font-style: italic">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E; text-decoration: underline">AuthenticationModuleInstaller</span><span style="color: #F8F8F2"> : </span><span style="color: #A6E22E; text-decoration: underline">IModuleInstaller</span></span>
<span class="line"><span style="color: #F8F8F2">{</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">public</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">void</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">InstallModule</span><span style="color: #F8F8F2">(</span><span style="color: #A6E22E; text-decoration: underline">IServiceCollection</span><span style="color: #F8F8F2"> serviceCollection, </span><span style="color: #A6E22E; text-decoration: underline">IConfiguration</span><span style="color: #F8F8F2"> configuration) </span><i class="conum" data-value="1"></i><b>(1)</b></span>
<span class="line"><span style="color: #F8F8F2">    {</span></span>
<span class="line"><span style="color: #F8F8F2">        serviceCollection.</span><span style="color: #A6E22E">InstallServicesFromAssemblies</span><span style="color: #F8F8F2">(configuration, AssemblyReference.Assembly); </span><i class="conum" data-value="2"></i><b>(2)</b></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span></code></pre></body></html>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The interface will have an <code>InstallModule</code> method to which we feed both the <code>IServiceCollection</code>
and the <code>IConfiguration</code> objects coming straight from the app. And this method
ideally should be used to make different additions of different types of services and
extras to the application.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>It&#8217;s from this specific place that we can then call another extension method called
<code>InstallServicesFromAssemblies</code>. This method follows the same idea as the module approach,
we can feed an (n) number of assembly targets to it so that it scans them and then runs
the respective method specific to a <code>IServiceInstaller</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>One such <code>IServiceInstaller</code> would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<html><head></head><body><pre class="shiki highlight monokai" style="--shiki-background-color: #272822; --shiki-conum-bg-color: #d2d2cd; --shiki-conum-fg-color: #000000;"><code data-lang="csharp" class="shiki has-line-numbers override-conums" style="--shiki-line-number-start: 1; --shiki-line-number-color: #757866;"><span class="line"><span style="color: #F92672">using</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E; text-decoration: underline">Common</span><span style="color: #F8F8F2">.</span><span style="color: #A6E22E; text-decoration: underline">Library</span><span style="color: #F8F8F2">.</span><span style="color: #A6E22E; text-decoration: underline">Interfaces</span><span style="color: #F8F8F2">;</span></span>
<span class="line"><span style="color: #F92672">using</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E; text-decoration: underline">Microsoft</span><span style="color: #F8F8F2">.</span><span style="color: #A6E22E; text-decoration: underline">Extensions</span><span style="color: #F8F8F2">.</span><span style="color: #A6E22E; text-decoration: underline">Configuration</span><span style="color: #F8F8F2">;</span></span>
<span class="line"><span style="color: #F92672">using</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E; text-decoration: underline">Microsoft</span><span style="color: #F8F8F2">.</span><span style="color: #A6E22E; text-decoration: underline">Extensions</span><span style="color: #F8F8F2">.</span><span style="color: #A6E22E; text-decoration: underline">DependencyInjection</span><span style="color: #F8F8F2">;</span></span>
<span class="line"><span style="color: #F92672">using</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E; text-decoration: underline">Modules</span><span style="color: #F8F8F2">.</span><span style="color: #A6E22E; text-decoration: underline">Authentication</span><span style="color: #F8F8F2">.</span><span style="color: #A6E22E; text-decoration: underline">GoogleOAuth</span><span style="color: #F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #66D9EF; font-style: italic">namespace</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E; text-decoration: underline">Modules</span><span style="color: #F8F8F2">.</span><span style="color: #A6E22E; text-decoration: underline">Authentication</span><span style="color: #F8F8F2">.</span><span style="color: #A6E22E; text-decoration: underline">ServiceInstallers</span><span style="color: #F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672">public</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF; font-style: italic">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E; text-decoration: underline">RepositoryServicesInstaller</span><span style="color: #F8F8F2"> : </span><span style="color: #A6E22E; text-decoration: underline">IServiceInstaller</span></span>
<span class="line"><span style="color: #F8F8F2">{</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">public</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">void</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">Install</span><span style="color: #F8F8F2">(</span><span style="color: #A6E22E; text-decoration: underline">IServiceCollection</span><span style="color: #F8F8F2"> app, </span><span style="color: #A6E22E; text-decoration: underline">IConfiguration</span><span style="color: #F8F8F2"> configuration) </span><i class="conum" data-value="1"></i><b>(1)</b></span>
<span class="line"><span style="color: #F8F8F2">    {</span></span>
<span class="line"><span style="color: #F8F8F2">        app.</span><span style="color: #A6E22E">AddScoped</span><span style="color: #F8F8F2">&lt;</span><span style="color: #A6E22E; text-decoration: underline">IGoogleOAuthRepository</span><span style="color: #F8F8F2">, </span><span style="color: #A6E22E; text-decoration: underline">GoogleOAuthRepository</span><span style="color: #F8F8F2">&gt;(); </span><i class="conum" data-value="2"></i><b>(2)</b></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span></code></pre></body></html>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Under an <code>Install</code> method we should have all the specific code that will start saving
into the DI container of the app all the services that we want to register from the
module (and that are specific to our sub-domain).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>For example, we could have a <code>RepositoryServicesInstaller</code> in charge of only registering
all the repositories that live in the module. And it will only take care of registering that.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In theory we could be creating tons of <code>IServiceInstaller</code> implementations each
specialized on an specific type of service/logging/DI registration onto the app&#8217;s
DI container.</p>
</div>
<div class="paragraph">
<p>And so the way the flow of module installation should follow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>app =&gt; IModuleInstaller =&gt; IServiceInstaller

app =&gt; IEndpointDefinition</pre>
</div>
</div>
<div class="paragraph">
<p><strong><em>Assembly Scanning</em></strong> is what we are leveraging a ton to make code more concise,
and less boilerplaity. The key lies at <em>registering the classes under the right interface</em>.
Once you do that, then everything should fall into place, since all the abstracted
general purpose code is already there. And now integrating and extending should be
a really mechanical process.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="../git-hooks.html">Git Hooks</a></span>
  <span class="next"><a href="oauth.html">OAuth</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
